# 认购计划 V2 - 业务规格说明

## 📋 认购计划参数表

| planCode | 主投资额(USDT) | 静态收益% | 周期(天) | AI Token奖励% | 抽奖次数 |
|----------|----------------|-----------|----------|---------------|----------|
| PLAN500  | 500           | 6%        | 15       | 3%            | 3        |
| PLAN1K   | 1,000         | 7%        | 20       | 4%            | 3        |
| PLAN2K   | 2,000         | 8%        | 25       | 5%            | 3        |
| PLAN5K   | 5,000         | 10%       | 30       | 6%            | 3        |

## 🎯 业务规则

### 收益计算
- **静态收益** = 本金 × 静态收益%，一次性在周期结束时返还
- **AI Token奖励** = 本金 × AI Token奖励%，整数计算，无小数
- **抽奖次数** = 固定3次，在订单赎回时入账

### 推荐奖励规则
- **PLAN500**: 推荐人获得被推荐人静态收益的 **100%**
- **PLAN1K**: 推荐人获得被推荐人静态收益的 **90%**
- **PLAN2K**: 推荐人获得被推荐人静态收益的 **80%**
- **PLAN5K**: 推荐人获得被推荐人静态收益的 **70%**

### 购买限制
- ✅ **取消所有购买限制**
- ✅ 用户可自由多次认购任意档位
- ✅ 无每日限购、无总购买次数限制

## 💰 收益示例

### 500U 基础包
- 投资: 500 USDT
- 周期: 15天
- 静态收益: 500 × 6% = 30 USDT
- AI Token: 500 × 3% = 15 枚
- 抽奖次数: 3次
- 推荐奖励: 30 USDT (100%)

### 1,000U 成长包
- 投资: 1,000 USDT
- 周期: 20天
- 静态收益: 1,000 × 7% = 70 USDT
- AI Token: 1,000 × 4% = 40 枚
- 抽奖次数: 3次
- 推荐奖励: 63 USDT (90%)

### 2,000U 进阶包
- 投资: 2,000 USDT
- 周期: 25天
- 静态收益: 2,000 × 8% = 160 USDT
- AI Token: 2,000 × 5% = 100 枚
- 抽奖次数: 3次
- 推荐奖励: 128 USDT (80%)

### 5,000U 旗舰包
- 投资: 5,000 USDT
- 周期: 30天
- 静态收益: 5,000 × 10% = 500 USDT
- AI Token: 5,000 × 6% = 300 枚
- 抽奖次数: 3次
- 推荐奖励: 350 USDT (70%)

## 🔄 提现系统更新

### 新提现流程
1. **用户申请提现** → 立即扣除虚拟USDT余额
2. **创建待审核记录** → 状态为 pending
3. **后台人工审核** → 通过/拒绝
4. **审核通过** → 状态更新为 approved
5. **审核拒绝** → 状态更新为 rejected，退还用户余额

### 移除功能
- ❌ 移除提现手续费
- ❌ 移除自动确认
- ❌ 移除区块链交易

## 🎰 抽奖系统

### 抽奖次数发放
- 所有档位统一发放 **3次抽奖**
- 在订单赎回时自动入账
- 通过 `spinQuotaGranted` 字段标记

## 🔧 技术实现

### 数据模型变更
- 移除 `maxPurchase` 字段
- 移除 `boxes` 字段
- 移除 `referralPct` 字段
- 保留 `tokenBonusPct` 字段

### 推荐奖励计算
```typescript
function calculateReferralReward(planCode: string, staticProfit: number): number {
  switch (planCode) {
    case 'PLAN500': return staticProfit;           // 100%
    case 'PLAN1K':  return staticProfit * 0.9;     // 90%
    case 'PLAN2K':  return staticProfit * 0.8;     // 80%
    case 'PLAN5K':  return staticProfit * 0.7;     // 70%
    default: return 0;
  }
}
```

### AI Token奖励
```typescript
const tokenBonusAmount = Math.round(principal * plan.tokenBonusPct / 100);
```

## 📱 前端展示文案

### 认购计划展示
```
全新四档认购计划

档位          投资额        周期    到期静态收益    额外奖励          抽奖福利
500U 基础包   500 USDT     15天    6% = 30U      15枚 AI Token     3次抽奖
1,000U 成长包 1,000 USDT   20天    7% = 70U      40枚 AI Token     3次抽奖
2,000U 进阶包 2,000 USDT   25天    8% = 160U     100枚 AI Token    3次抽奖
5,000U 旗舰包 5,000 USDT   30天    10% = 500U    300枚 AI Token    3次抽奖
```

### 推荐奖励说明
```
推荐奖励：您的下级赎回静态收益时，您将获得其静态收益的相应比例返佣：
- 500U档位：100%返佣
- 1,000U档位：90%返佣
- 2,000U档位：80%返佣
- 5,000U档位：70%返佣
```

### 业务特点
- ✅ 一次性收益：所有收益与奖励均在周期结束时一次性发放
- ✅ 认购次数不限：每位用户可自由多次认购任意档位
- ✅ 推荐奖励丰厚：最高可获得100%的静态收益返佣
- ✅ 双重奖励：USDT收益 + AI Token奖励 + 抽奖次数

## 🚀 部署说明

### 1. 更新数据模型
```bash
npm run strapi build
```

### 2. 运行数据更新脚本
```bash
node update-subscription-plans.js
```

### 3. 重启服务
```bash
npm run develop
```

## 📊 预期效果

### 用户收益提升
- 推荐奖励大幅提升（最高100%）
- 新增AI Token奖励
- 统一抽奖次数（3次）

### 运营便利性
- 取消购买限制，提高转化率
- 简化提现流程，减少用户困惑
- 统一收益发放时间，便于管理

### 系统稳定性
- 整数计算，避免精度问题
- 自动化处理，减少人工干预
- 完善的审核机制，保障资金安全 